import React, { useEffect, useState } from "react";
import { Link, useLocation, useHistory } from "react-router-dom";
import { AppBar, Avatar, Button, Toolbar, Typography } from "@material-ui/core";
import useStyles from "./styles";
import decode from "jwt-decode";

import plantLogo from "../../images/green-plant.jpg";
// import memoriesText from "../../images/memoriesText.png";
// import memoriesText from "../../images/AI-memories2.png";

import { useDispatch } from "react-redux";
const Navbar = () => {
  const classes = useStyles();
  const dispatch = useDispatch();
  const [user, setUser] = useState(JSON.parse(localStorage.getItem("profile")));
  const history = useHistory();
  const location = useLocation();

  const logout = () => {
    setUser(null);
    history.push("/");
    dispatch({ type: "LOGOUT" });
  };

  useEffect(() => {
    const token = user?.token;

    if (token) {
      const decodedToken = decode(token);
      if (decodedToken.exp * 1000 < new Date().getTime()) {
        logout();
      }
    }
    setUser(JSON.parse(localStorage.getItem("profile")));
  }, [location]);

  const handleCreate = () => {
    if(user){

    }
    else{
      
      history.push("/auth");
    }
  };
  return (
    <AppBar    
  className={classes.appBar} position="static" color="inherit">
      <Link to="/" className={classes.brandContainer}>

<svg width="263" height="57" viewBox="0 0 263 57" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.08594 35.4688H8.47754V9.27246H0.661133V4.74121H23.0059C25.1771 4.74121 27.1312 4.77897 28.8682 4.85449C30.624 4.93001 32.21 5.09993 33.626 5.36426C35.2874 5.68522 36.7035 6.14779 37.874 6.75195C39.0446 7.33724 39.9886 8.05469 40.7061 8.9043C41.4424 9.75391 41.971 10.7168 42.292 11.793C42.6318 12.8691 42.8018 14.0492 42.8018 15.333C42.8018 16.3903 42.613 17.4287 42.2354 18.4482C41.8766 19.4678 41.3385 20.4307 40.6211 21.3369C39.9036 22.2243 38.9974 23.0267 37.9023 23.7441C36.8262 24.4616 35.5706 25.0469 34.1357 25.5C32.6064 25.9531 30.9072 26.2458 29.0381 26.3779C27.1878 26.4912 25.1771 26.5479 23.0059 26.5479H14.9062V35.4688H24.9883V40H1.08594V35.4688ZM16.8887 28.5303H21.4199C23.0814 28.5303 24.5163 28.5208 25.7246 28.502C26.9329 28.4831 28.0091 28.4453 28.9531 28.3887C29.916 28.3132 30.7751 28.2188 31.5303 28.1055C32.3044 27.9733 33.0785 27.8128 33.8525 27.624C35.5895 27.2087 37.1377 26.6234 38.4971 25.8682C39.8564 25.0941 40.9987 24.1784 41.9238 23.1211C42.8678 22.0449 43.5853 20.8366 44.0762 19.4961C44.5671 18.1367 44.8125 16.6641 44.8125 15.0781C44.8125 13.1335 44.4349 11.4626 43.6797 10.0654C42.9434 8.64941 41.7822 7.375 40.1963 6.24219C41.1592 6.65755 42.0088 7.19564 42.7451 7.85645C43.4814 8.49837 44.0951 9.21582 44.5859 10.0088C45.0768 10.8018 45.445 11.6325 45.6904 12.501C45.9359 13.3695 46.0586 14.2285 46.0586 15.0781C46.0586 16.7585 45.7848 18.335 45.2373 19.8076C44.6898 21.2803 43.8874 22.6113 42.8301 23.8008C41.7917 24.9902 40.4984 26.0192 38.9502 26.8877C37.4209 27.7373 35.6556 28.3792 33.6543 28.8135C33.0501 28.9456 32.3704 29.0684 31.6152 29.1816C30.86 29.276 29.9915 29.361 29.0098 29.4365C28.028 29.4932 26.9141 29.5404 25.668 29.5781C24.4219 29.597 23.0059 29.6064 21.4199 29.6064H18.0215V33.7695H16.8887V28.5303ZM24.2236 22.0166C25.8285 22.0166 27.2256 21.9788 28.415 21.9033C29.6045 21.8278 30.6523 21.6579 31.5586 21.3936C33.1823 20.9404 34.3057 20.223 34.9287 19.2412C35.5706 18.2594 35.8916 17.0322 35.8916 15.5596C35.8916 14.4268 35.6839 13.4639 35.2686 12.6709C34.8532 11.8779 34.1829 11.2266 33.2578 10.7168C32.3327 10.207 31.1243 9.83887 29.6328 9.6123C28.1602 9.38574 26.3571 9.27246 24.2236 9.27246H14.9062V22.0166H24.2236ZM16.8887 11.2549H24.0254C26.9141 11.2549 29.1136 11.4154 30.624 11.7363C32.1533 12.0573 33.154 12.6143 33.626 13.4072C33.2484 13.2373 32.7952 13.0863 32.2666 12.9541C31.7568 12.8219 31.1243 12.7087 30.3691 12.6143C29.6139 12.5199 28.7171 12.4538 27.6787 12.416C26.6592 12.3594 25.4414 12.3311 24.0254 12.3311H18.0215V20.3174H16.8887V11.2549ZM2.19043 11.2549H6.69336V12.3311H2.19043V11.2549ZM27.0273 41.9824V37.0547H28.1602V43.0586H2.89844V41.9824H27.0273ZM50.4482 35.752H56.6787V4.74121H50.4482V0.493164H62.7676V35.752H68.998V40H50.4482V35.752ZM64.75 1.9375H65.8828V34.0527H64.75V1.9375ZM52.1475 6.72363H55.4893V7.7998H52.1475V6.72363ZM71.0371 41.9824V37.3379H72.1699V43.0586H52.1475V41.9824H71.0371ZM77.4375 26.4346C77.4375 24.6787 77.8057 22.9323 78.542 21.1953C79.2783 19.4583 80.3639 17.9007 81.7988 16.5225C83.2526 15.1253 85.0462 13.9925 87.1797 13.124C89.3132 12.2555 91.7676 11.8213 94.543 11.8213C95.4303 11.8213 96.3743 11.8874 97.375 12.0195C98.3945 12.1517 99.4046 12.3688 100.405 12.6709C101.425 12.973 102.416 13.3789 103.379 13.8887C104.342 14.3796 105.22 14.9837 106.013 15.7012V12.6709H118.19V17.4854H111.96V35.752H118.19V40H106.013V36.3184C105.276 37.0547 104.436 37.7061 103.492 38.2725C102.567 38.8389 101.576 39.3109 100.519 39.6885C99.4801 40.0661 98.3945 40.3493 97.2617 40.5381C96.1478 40.7458 95.0339 40.8496 93.9199 40.8496C91.2012 40.8496 88.8128 40.4626 86.7549 39.6885C84.6969 38.9144 82.9788 37.876 81.6006 36.5732C80.2223 35.2516 79.1839 33.7223 78.4854 31.9854C77.7868 30.2295 77.4375 28.3792 77.4375 26.4346ZM113.999 19.4678H120.229V14.8232H121.362V20.5439H115.132V34.0527H113.999V19.4678ZM83.583 26.208C83.583 27.7751 83.8568 29.1911 84.4043 30.4561C84.9707 31.721 85.7354 32.7972 86.6982 33.6846C87.6611 34.5719 88.8034 35.2611 90.125 35.752C91.4466 36.2428 92.8721 36.4883 94.4014 36.4883C95.2887 36.4883 96.1855 36.4033 97.0918 36.2334C98.0169 36.0446 98.9043 35.7708 99.7539 35.4121C100.622 35.0345 101.434 34.5719 102.189 34.0244C102.964 33.458 103.624 32.7972 104.172 32.042C104.738 31.2679 105.182 30.39 105.503 29.4082C105.843 28.4264 106.013 27.3314 106.013 26.123C106.013 24.7826 105.701 23.5176 105.078 22.3281C104.455 21.1198 103.615 20.0625 102.558 19.1562C101.519 18.25 100.301 17.5326 98.9043 17.0039C97.5072 16.4753 96.0345 16.2109 94.4863 16.2109C92.9382 16.2109 91.4938 16.4469 90.1533 16.9189C88.8317 17.391 87.68 18.0612 86.6982 18.9297C85.7354 19.7982 84.9707 20.8555 84.4043 22.1016C83.8568 23.3288 83.583 24.6976 83.583 26.208ZM85.5371 26.3496C85.5371 25.1602 85.7542 24.0745 86.1885 23.0928C86.6416 22.0921 87.2646 21.2331 88.0576 20.5156C88.8506 19.7793 89.7946 19.2129 90.8896 18.8164C91.9847 18.401 93.1836 18.1934 94.4863 18.1934C95.4681 18.1934 96.3555 18.3066 97.1484 18.5332C97.9414 18.7409 98.6305 19.0052 99.2158 19.3262C99.8011 19.6283 100.283 19.9492 100.66 20.2891C101.038 20.61 101.302 20.8932 101.453 21.1387C100.434 20.5723 99.3857 20.1191 98.3096 19.7793C97.2334 19.4395 95.959 19.2695 94.4863 19.2695C93.2969 19.2695 92.2207 19.4678 91.2578 19.8643C90.3138 20.2419 89.502 20.7611 88.8223 21.4219C88.1426 22.0827 87.6139 22.8473 87.2363 23.7158C86.8776 24.5843 86.6982 25.5 86.6982 26.4629C86.6982 27.3691 86.8021 28.2188 87.0098 29.0117C87.2174 29.8047 87.5479 30.541 88.001 31.2207C88.473 31.8815 89.0771 32.4951 89.8135 33.0615C90.5687 33.609 91.4749 34.0905 92.5322 34.5059C91.3428 34.2982 90.3044 33.9489 89.417 33.458C88.5485 32.9482 87.8216 32.3346 87.2363 31.6172C86.6699 30.8997 86.2451 30.0973 85.9619 29.21C85.6787 28.3037 85.5371 27.3503 85.5371 26.3496ZM120.229 41.9824V37.3379H121.362V43.0586H107.712V41.9824H120.229ZM81.0908 38.7822C81.8649 39.4053 82.7428 39.9622 83.7246 40.4531C84.7064 40.9629 85.7542 41.3877 86.8682 41.7275C87.9821 42.0863 89.1338 42.36 90.3232 42.5488C91.5316 42.7376 92.7399 42.832 93.9482 42.832C96.0439 42.832 97.998 42.5677 99.8105 42.0391C101.642 41.5293 103.266 40.8118 104.682 39.8867V41.1895C103.266 42.0391 101.623 42.6999 99.7539 43.1719C97.9036 43.6628 95.9779 43.9082 93.9766 43.9082C92.5983 43.9082 91.2484 43.7949 89.9268 43.5684C88.6051 43.3607 87.3779 43.0397 86.2451 42.6055C85.1123 42.1712 84.1022 41.6331 83.2148 40.9912C82.3275 40.3493 81.6195 39.613 81.0908 38.7822ZM129.377 35.752H135.607V17.4854H129.377V12.6709H141.696V16.9473C142.282 16.2298 142.98 15.5596 143.792 14.9365C144.623 14.3135 145.548 13.7754 146.567 13.3223C147.587 12.8503 148.691 12.4821 149.881 12.2178C151.07 11.9535 152.316 11.8213 153.619 11.8213C155.583 11.8213 157.367 12.1045 158.972 12.6709C160.576 13.2184 161.945 14.0775 163.078 15.248C164.211 16.3997 165.079 17.863 165.684 19.6377C166.307 21.3936 166.618 23.4798 166.618 25.8965V35.752H172.849V40H155.715V35.752H160.529V28.3037C160.529 26.7744 160.454 25.415 160.303 24.2256C160.171 23.0173 159.972 22.0732 159.708 21.3936C159.368 20.5251 158.934 19.7887 158.405 19.1846C157.896 18.5804 157.31 18.0895 156.649 17.7119C156.007 17.3343 155.299 17.0605 154.525 16.8906C153.751 16.7207 152.93 16.6357 152.062 16.6357C151.136 16.6357 150.174 16.8057 149.173 17.1455C148.191 17.4854 147.228 17.9668 146.284 18.5898C145.359 19.194 144.491 19.9115 143.679 20.7422C142.886 21.5729 142.225 22.4697 141.696 23.4326V35.752H146.511V40H129.377V35.752ZM168.657 26.0947C168.657 24.4333 168.525 22.8945 168.261 21.4785C168.015 20.0436 167.638 18.7598 167.128 17.627C166.618 16.4753 165.986 15.484 165.23 14.6533C164.494 13.8226 163.635 13.1618 162.653 12.6709C163.937 12.9919 165.032 13.5394 165.938 14.3135C166.845 15.0687 167.581 16.0316 168.147 17.2021C168.714 18.3727 169.129 19.7227 169.394 21.252C169.658 22.7812 169.79 24.4616 169.79 26.293V34.0527H168.657V26.0947ZM143.735 24.1406C144.207 23.3099 144.764 22.5547 145.406 21.875C146.067 21.1953 146.775 20.6195 147.53 20.1475C148.304 19.6566 149.107 19.279 149.938 19.0146C150.787 18.7503 151.627 18.6182 152.458 18.6182C153.761 18.6182 154.818 18.8636 155.63 19.3545C156.442 19.8454 157.036 20.4684 157.414 21.2236C156.829 20.7894 156.14 20.4212 155.347 20.1191C154.573 19.8171 153.591 19.666 152.401 19.666C151.665 19.666 150.919 19.8076 150.164 20.0908C149.409 20.3551 148.691 20.7139 148.012 21.167C147.332 21.6201 146.718 22.1393 146.171 22.7246C145.623 23.3099 145.189 23.9046 144.868 24.5088V34.0527H143.735V24.1406ZM131.076 19.4678H134.418V20.5439H131.076V19.4678ZM174.888 41.9824V37.3379H176.021V43.0586H157.414V41.9824H174.888ZM148.55 41.9824V37.3379H149.683V43.0586H131.076V41.9824H148.55ZM185.564 17.4854H179.334V12.6709H185.564V6.9502L191.653 4.40137V12.6709H205.729V17.4854H191.653V30.9941C191.653 32.4102 192.097 33.4674 192.984 34.166C193.872 34.8457 195.08 35.1855 196.609 35.1855H204.596V40H196.609C195.08 40 193.645 39.8395 192.305 39.5186C190.964 39.1787 189.794 38.6217 188.793 37.8477C187.792 37.0547 186.999 36.0163 186.414 34.7324C185.848 33.4297 185.564 31.806 185.564 29.8613V17.4854ZM193.692 5.95898L194.825 5.44922V10.9717H193.692V5.95898ZM193.636 19.1562H207.768V13.9453H208.9V20.2324H194.769V33.2881C194.127 33.1182 193.749 32.7406 193.636 32.1553V19.1562ZM181.033 19.4678H184.432V20.5439H181.033V19.4678ZM185.395 37.5645C185.999 38.4141 186.669 39.1221 187.405 39.6885C188.16 40.2549 189.001 40.708 189.926 41.0479C190.851 41.3877 191.861 41.6237 192.956 41.7559C194.051 41.9069 195.25 41.9824 196.553 41.9824H206.635V36.46H207.768V43.0586H196.411C194.957 43.0586 193.636 42.9642 192.446 42.7754C191.257 42.5866 190.2 42.2751 189.274 41.8408C188.368 41.4255 187.585 40.859 186.924 40.1416C186.282 39.443 185.772 38.584 185.395 37.5645ZM230.367 49.1191L234.7 41.0479L218.897 16.9189H212.837V12.6709H232.18V16.9189H226.176L237.872 35.1572L247.671 16.9189H240.789V12.6709H259.65V16.9189H253.901L234.021 53.3672H223.174V49.1191H230.367ZM235.493 55.3496L255.402 18.9014H261.689V14.2568H262.822V19.9775H256.054L236.201 56.4258H224.873V55.3496H235.493ZM230.169 18.9014H234.219V14.2568H235.352V19.9775H232.18L238.722 30.1729L238.099 31.3057L230.169 18.9014ZM242.177 18.9014H245.122L244.556 19.9775H242.177V18.9014ZM214.536 18.9014H218.643L219.351 19.9775H214.536V18.9014Z" fill="#49B805"/>
</svg>

 
        <img
          className={classes.image}
          src={plantLogo}
          alt="icon"
          height="50px"
        />
      </Link>
      <Toolbar className={classes.toolbar} varient="dense">
       
        {user ? (
          <div className={classes.profile}>
            <Avatar
              className={classes.purple}
              alt={user.result.name}
              src={user.result.picture}
            >
              {user.result.name.charAt(0)}
            </Avatar>
            <Typography className={classes.userName} varient="h6">
              &nbsp;
              {user.result.name}
            </Typography>
            <Button
              className={classes.logout}
              variant="contained"
              color="secondary"
              onClick={logout}
              to="/auth"
            >
              Logout
            </Button>
          </div>
        ) : (
          <Button
            component={Link}
            to="/auth"
            variant="contained"
            color="primary"
          >
            {" "}
            Sign In
          </Button>
        )}
      </Toolbar>
    </AppBar>
  );
};

export default Navbar;
